
{% extends 'google/base.html' %}
{% block content %}
{% load static %}

<script>

    $(document).ready(function(){
        $.ajax({
            url: "{% url 'mydata'%}",
            method: 'GET',
            success: function (data) {
                console.log(data);
                initMap(data);
            }
      });
    });

    function initMap(data) {
       const map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: {lat: 3.933215078541915, lng: -76.56998432650508}
       });

       const infoWindow = new google.maps.InfoWindow();

       const markers = data?.map((i) => {
            const marker = new google.maps.Marker({
                position: { lat: parseFloat(i.latitude), lng: parseFloat(i.longitude)},
                map: map,
                title: `${i.nombre}`,
                optimized: false,
            });
            marker.addListener("click", () => {
              infoWindow.close();
              infoWindow.setContent(marker.getTitle());
              infoWindow.open(marker.getMap(), marker);
            });
        });
     }
  </script>


<div class="pageholder">
    <a href="{% url 'crearEmpresa'%}">Crear</a>
    <div class="linkholder">
        <div class="mapholder">
            <div id="map"></div>
            <script
            src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap&v=weekly"
            defer
            ></script>
        </div>
    </div>
</div>



{% endblock content %}